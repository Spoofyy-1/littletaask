name: Build and Release LittleTask

on:
  push:
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
    
    - name: Build LittleTask
      run: |
        swift build -c release
        
    - name: Create App Bundle
      run: |
        ./build.sh
        
    - name: Upload DMG as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: LittleTask-DMG
        path: LittleTask-v1.0.0.dmg
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          LittleTask-v1.0.0.dmg
          README.md
          LICENSE
        body: |
          ## LittleTask ${{ github.ref_name }}
          
          ### Features
          - 🎬 Record and replay mouse movements, clicks, and keyboard inputs
          - ⚡ Variable speed playback (0.1x to 5.0x)
          - 💾 Save and load automation sequences
          - 🔒 Privacy-first design
          - ⌨️ Keyboard shortcuts: ⌘R (Record), ⌘P (Play), ⌘⌫ (Clear)
          
          ### Installation
          1. Download the DMG file
          2. Mount and drag LittleTask.app to Applications
          3. Launch and grant Accessibility permissions
          
          ### System Requirements
          - macOS 13.0+ (Ventura or later)
          - Apple Silicon or Intel Mac
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 